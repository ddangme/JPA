# ëª©ì°¨
1. [íšŒì› ë„ë©”ì¸ ê°œë°œ](#íšŒì›-ë„ë©”ì¸-ê°œë°œ)
2. [ìƒí’ˆ ë„ë©”ì¸ ê°œë°œ](#ìƒí’ˆ-ë„ë©”ì¸-ê°œë°œ)

## íšŒì› ë„ë©”ì¸ ê°œë°œ
### êµ¬í˜„ ê¸°ëŠ¥
- íšŒì› ë“±ë¡
- íšŒì› ëª©ë¡ ì¡°íšŒ

### ìˆœì„œ
- [íšŒì› ë ˆí¬ì§€í† ë¦¬ ê°œë°œ](#íšŒì›-ë ˆí¬ì§€í† ë¦¬-ê°œë°œ)
- [íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ](#íšŒì›-ì„œë¹„ìŠ¤-ê°œë°œ)
- [íšŒì› ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸](#íšŒì›-ê¸°ëŠ¥-í…ŒìŠ¤íŠ¸)

### [íšŒì› ë ˆí¬ì§€í† ë¦¬ ê°œë°œ](..%2F..%2Fsrc%2Fmain%2Fjava%2Fddangme%2Fjpa%2Frepository%2FMemberRepository.java)
```java
@Repository
@RequiredArgsConstructor
public class MemberRepository {

    private final EntityManager em;

    public void save(Member member) {
        em.persist(member);
    }

    public Member findOne(Long id) {
        return em.find(Member.class, id);
    }
    
    public List<Member> findAll() {
        return em.createQuery("SELECT m FROM Member m", Member.class)
                .getResultList();
    }

    public List<Member> findByName(String name) {
        return em.createQuery("SELECT m FROM Member m WHERE m.name = :name", Member.class)
                .setParameter("name", name)
                .getResultList();
    }
}
```

### [íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ](..%2F..%2Fsrc%2Fmain%2Fjava%2Fddangme%2Fjpa%2Fservice%2FMemberService.java)
```java
@Service
@Transactional(readOnly = true)
public class MemberService {

    @Autowired
    MemberRepository memberRepository;

    @Transactional
    public Long join(Member member) {
        validateDuplicateMember(member);
        return member.getId();
    }

    private void validateDuplicateMember(Member member) {
        List<Member> findMembers = memberRepository.findByName(member.getName());

        if (!findMembers.isEmpty()) {
            throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
        }
    }
    
    public List<Member> findMembers() {
        return memberRepository.findAll();
    }

    public Member findOne(Long memberId) {
        return memberRepository.findOne(memberId);
    }
}
```

### íšŒì› ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
#### í…ŒìŠ¤íŠ¸ ìš”êµ¬ì‚¬í•­
- íšŒì› ê°€ì…ì„ ì„±ê³µí•´ì•¼ í•œë‹¤.
- íšŒì›ê°€ì… í•  ë•Œ ì´ë¯¸ ê°€ì…ëœ ì´ë¦„ì´ ìˆìœ¼ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•´ì•¼ í•œë‹¤.
```java
@SpringBootTest
class MemberServiceTest {

    @Autowired
    MemberService memberService;

    @Autowired
    MemberRepository memberRepository;

    @Test
    void íšŒì›ê°€ì…() throws Exception {
        // Given
        Member member = new Member();
        member.setName("Kim");

        // When
        Long saveId = memberService.join(member);

        // Then
        assertThat(member.getId()).isEqualTo(memberService.findOne(saveId).getId());
    }

    @Test
    void ì¤‘ë³µ_íšŒì›_ì˜ˆì™¸() throws Exception {
        // Given
        Member member1 = new Member();
        member1.setName("Kim");

        Member member2 = new Member();
        member2.setName("Kim");

        memberService.join(member1);
        // When
        assertThatThrownBy(() -> {
            memberService.join(member2);
        })
                .isInstanceOf(IllegalStateException.class)
                .hasMessage("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
    }

}
```

#### ê¸°ìˆ  ì„¤ëª…
- `@SpringBootTest`
  - ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ë„ìš°ê³  í…ŒìŠ¤íŠ¸ (ì´ê²Œ ì—†ìœ¼ë©´ `@Autowired` ë‹¤ ì‹¤íŒ¨)
- `@Transactional`
  - ë°˜ë³µ ê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸ ì§€ì›, ê°ê°ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ë•Œë§ˆë‹¤ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³ , í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´ íŠ¸ëœì­ì…˜ì„ ê°•ì œë¡œ ë¡¤ë°±
  - ì´ ì• ë…¸í…Œì´ì…˜ì´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì—ì„œ ì‚¬ìš©ë  ë•Œë§Œ ë¡¤ë°±

### í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ìœ„í•œ ì„¤ì •
í…ŒìŠ¤íŠ¸ëŠ” ì¼€ì´ìŠ¤ ê²©ë¦¬ëœ í™˜ê²½ì—ì„œ ì‹¤í–‰í•˜ê³ , ëë‚˜ë©´ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
ê·¸ëŸ° ë©´ì—ì„œ ë©”ëª¨ë¦¬ DBë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì´ìƒì ì´ë‹¤.

ì¶”ê°€ë¡œ, í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ìœ„í•œ ìŠ¤í”„ë§ í™˜ê²½ê³¼ ì¼ë°˜ì ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ëŠ” í™˜ê²½ì€ ë³´í†µ ë‹¤ë¥´ë¯€ë¡œ ì„¤ì • íŒŒì¼ì„ ë‹¤ë¥´ê²Œ ì‚¬ìš©í•˜ì.

ë‹¤ìŒê³¼ ê°™ì´ ê°„ë‹¨í•˜ê²Œ í…ŒìŠ¤íŠ¸ìš© ì„¤ì • íŒŒì¼ì„ ì¶”ê°€í•˜ë©´ ëœë‹¤.

[application.yml](..%2F..%2Fsrc%2Ftest%2Fresources%2Fapplication.yml)

ì´ì œ í…ŒìŠ¤íŠ¸ì—ì„œ ìŠ¤í”„ë§ì„ ì‹¤í–‰í•˜ë©´ ì´ ìœ„ì¹˜ì— ìˆëŠ” ì„¤ì • íŒŒì¼ì„ ì½ëŠ”ë‹¤.

ë§Œì•½ ì´ ìœ„ì¹˜ì— ì—†ìœ¼ë©´ `src/resources/application.yml`ì„ ì½ëŠ”ë‹¤.

ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” `datasource` ì„¤ì •ì´ ì—†ìœ¼ë©´, ê¸°ë³¸ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ DBë¥¼ ì‚¬ìš©í•˜ê³ , `driver-class`ë„ í˜„ì¬ ë“±ë¡ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë³´ê³  ì°¾ì•„ì¤€ë‹¤.
ì¶”ê°€ë¡œ `ddl-auto`ë„ `create-drop`ëª¨ë“œë¡œ ë™ì‘í•œë‹¤. ë”°ë¼ì„œ ë°ì´í„° ì†ŒìŠ¤ë‚˜, JPA ê´€ë ¨ ë³„ë„ì˜ ì¶”ê°€ ì„¤ì •ì„ í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

## ìƒí’ˆ ë„ë©”ì¸ ê°œë°œ
### êµ¬í˜„ ê¸°ëŠ¥
- ìƒí’ˆ ë“±ë¡
- ìƒí’ˆ ëª©ë¡ ì¡°íšŒ
- ìƒí’ˆ ìˆ˜ì •
### ìˆœì„œ
- [ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ(ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ê°€)](#ìƒí’ˆ-ì—”í‹°í‹°-ê°œë°œë¹„ì¦ˆë‹ˆìŠ¤-ë¡œì§-ì¶”ê°€)
- [ìƒí’ˆ ë ˆí¬ì§€í† ë¦¬ ê°œë°œ](#ìƒí’ˆ-ë ˆí¬ì§€í† ë¦¬-ê°œë°œ)
- [ìƒí’ˆ ì„œë¹„ìŠ¤ ê°œë°œ](#ìƒí’ˆ-ì„œë¹„ìŠ¤-ê°œë°œ)
- [ìƒí’ˆ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸](#ìƒí’ˆ-ê¸°ëŠ¥-í…ŒìŠ¤íŠ¸)

### [ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ(ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ê°€)](..%2F..%2Fsrc%2Fmain%2Fjava%2Fddangme%2Fjpa%2Fdomain%2Fitem%2FItem.java)
```java
public void addStock(int quantity) {
    this.stockQuantity = quantity;
}

public void removeStock(int quantity) {
    int restStock = this.stockQuantity - quantity;

    if (restStock < 0) {
        throw new NotEnoughStockException("need more stock");
    }

    this.stockQuantity = restStock;
}
```

#### [ì˜ˆì™¸ ì¶”ê°€](..%2F..%2Fsrc%2Fmain%2Fjava%2Fddangme%2Fjpa%2Fexception%2FNotEnoughStockException.java)
```java
public class NotEnoughStockException extends RuntimeException {

    public NotEnoughStockException() { }

    public NotEnoughStockException(String message) {
        super(message);
    }

    public NotEnoughStockException(String message, Throwable cause) {
        super(message, cause);
    }

    public NotEnoughStockException(Throwable cause) {
        super(cause);
    }
}
```

#### ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¶„ì„
- `addStock()`
  - íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ ìˆ˜ ë§Œí¼ ì¬ê³ ë¥¼ ëŠ˜ë¦°ë‹¤.
  - ì´ ë©”ì„œë“œëŠ” ì¬ê³ ê°€ ì¦ê°€í•˜ê±°ë‚˜ ìƒí’ˆ ì£¼ë¬¸ì„ ì·¨ì†Œí•´ì„œ ì¬ê³ ë¥¼ ë‹¤ì‹œ ëŠ˜ë ¤ì•¼ í•  ë•Œ ì‚¬ìš©í•œë‹¤.
- `removeStock()`
  - íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ ìˆ˜ë§Œí¼ ì¬ê³ ë¥¼ ì¤„ì¸ë‹¤. 
  - ë§Œì•½ ì¬ê³ ê°€ ë¶€ì¡±í•˜ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.
  - ì£¼ë¡œ ìƒí’ˆì„ ì£¼ë¬¸í•  ë•Œ ì‚¬ìš©í•œë‹¤.

### [ìƒí’ˆ ë ˆí¬ì§€í† ë¦¬ ê°œë°œ](..%2F..%2Fsrc%2Fmain%2Fjava%2Fddangme%2Fjpa%2Frepository%2FItemRepository.java)
```java
@Repository
@RequiredArgsConstructor
public class ItemRepository {
    
    private final EntityManager em;

    public void save(Item item) {
        if (item.getId() == null) {
            em.persist(item);
        } else {
            em.merge(item);
        }
    }

    public Item findOne(Long id) {
        return em.find(Item.class, id);
    }

    public List<Item> findAll() {
        return em.createQuery("SELECT i FROM Item i", Item.class)
                .getResultList();
    }
}
```

#### ê¸°ëŠ¥ ì„¤ëª…
- `save()`
  - `id`ê°€ ì—†ìœ¼ë©´ ì‹ ê·œë¡œ ë³´ê³  `persist()` ì‹¤í–‰
  - `id`ê°€ ìˆìœ¼ë©´ ì´ë¯¸ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ ì—”í‹°í‹°ë¥¼ ìˆ˜ì •í•œë‹¤ê³  ë³´ê³ , `merge()`ë¥¼ ì‹¤í–‰

### ìƒí’ˆ ì„œë¹„ìŠ¤ ê°œë°œ
```java
@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor
public class ItemService {

    private final ItemRepository itemRepository;

    @Transactional
    public void saveItem(Item item) {
        itemRepository.save(item);
    }

    public List<Item> findItems() {
        return itemRepository.findAll();
    }

    public Item findOne(Long itemId) {
        return itemRepository.findOne(itemId);
    }
}
```
- ìƒí’ˆ ì„œë¹„ìŠ¤ëŠ” ìƒí’ˆ ë ˆí¬ì§€í† ë¦¬ì— ë‹¨ìˆœíˆ ìœ„ì„ë§Œ í•˜ëŠ” í´ë˜ìŠ¤

### ìƒí’ˆ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
ìƒí’ˆ í…ŒìŠ¤íŠ¸ëŠ” íšŒì› í…ŒìŠ¤íŠ¸ì™€ ë¹„ìŠ·í•˜ë¯€ë¡œ ìƒëµ

## ì£¼ë¬¸ ë„ë©”ì¸ ê°œë°œ
### êµ¬í˜„ ê¸°ëŠ¥
- ìƒí’ˆ ì£¼ë¬¸
- ì£¼ë¬¸ ë‚´ì—­ ì¡°íšŒ
- ì£¼ë¬¸ ì·¨ì†Œ
### ìˆœì„œ
- [ì£¼ë¬¸ ì—”í‹°í‹° ê°œë°œ](#ì£¼ë¬¸-ì—”í‹°í‹°-ê°œë°œ)
- [ì£¼ë¬¸ ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ](#ì£¼ë¬¸-ìƒí’ˆ-ì—”í‹°í‹°-ê°œë°œ)
- [ì£¼ë¬¸ ë ˆí¬ì§€í† ë¦¬ ê°œë°œ](#ì£¼ë¬¸-ë ˆí¬ì§€í† ë¦¬-ê°œë°œ)
- [ì£¼ë¬¸ ì„œë¹„ìŠ¤ ê°œë°œ](#ì£¼ë¬¸-ì„œë¹„ìŠ¤-ê°œë°œ)
- ì£¼ë¬¸ ê²€ìƒ‰ ê¸°ëŠ¥ ê°œë°œ
- [ì£¼ë¬¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸](#ì£¼ë¬¸-ê¸°ëŠ¥-í…ŒìŠ¤íŠ¸)

### ì£¼ë¬¸ ì—”í‹°í‹° ê°œë°œ
```java
public static Order createOrder(Member member, Delivery delivery, OrderItem... orderItems) {
    Order order = new Order();
    order.setMember(member);
    order.setDelivery(delivery);
    order.orderItems.addAll(Arrays.asList(orderItems));
    order.setOrderStatus(OrderStatus.ORDER);
    order.setOrderDate(LocalDateTime.now());
    
    return order;
}

public void cancel() {
    if (delivery.getStatus() == DeliveryStatus.COMP) {
        throw new IllegalStateException("ì´ë¯¸ ë°°ì†¡ì™„ë£Œëœ ìƒí’ˆì€ ì·¨ì†Œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.");
    }

    this.setOrderStatus(OrderStatus.CANCEL);

    for (OrderItem orderItem : orderItems) {
        orderItem.cancel();
    }
}

public int getTotalPrice() {
    int totalPrice = 0;

    for (OrderItem orderItem : orderItems) {
        totalPrice += orderItem.getOrderPrice();
    }

    return totalPrice;
}
```

#### ê¸°ëŠ¥ ì„¤ëª…
- `createOrder()`
  - ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©í•œë‹¤.
  - ì£¼ë¬¸ íšŒì›, ë°°ì†¡ì •ë³´, ì£¼ë¬¸ìƒí’ˆì˜ ì •ë³´ë¥¼ ë°›ì•„ì„œ ì‹¤ì œ ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ìƒì„±í•œë‹¤.
- `cancel()`
  - ì£¼ë¬¸ ì·¨ì†Œ ì‹œ ì‚¬ìš©í•œë‹¤.
  - ì£¼ë¬¸ ìƒíƒœë¥¼ ì·¨ì†Œë¡œ ë³€ê²½í•˜ê³ , ì£¼ë¬¸ìƒí’ˆì— ì£¼ë¬¸ ì·¨ì†Œë¥¼ ì•Œë¦°ë‹¤.
  - ë§Œì•½ ì´ë¯¸ ë°°ì†¡ì„ ì™„ë£Œí•œ ìƒí’ˆì´ë©´ ì£¼ë¬¸ì„ ì·¨ì†Œí•˜ì§€ ëª»í•˜ë„ë¡ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.
- `getTotalPrice()`
  - ì£¼ë¬¸ ì‹œ ì‚¬ìš©í•œ ì „ì²´ ì£¼ë¬¸ ê°€ê²©ì„ ì¡°íšŒí•œë‹¤.
  - ì „ì²´ ì£¼ë¬¸ ê°€ê²©ì„ ì•Œë ¤ë©´ ê°ê°ì˜ ì£¼ë¬¸ ìƒí’ˆ ê°€ê²©ì„ ì•Œì•„ì•¼ í•œë‹¤.
  - ë¡œì§ì„ ë³´ë©´ ì—°ê´€ëœ ì£¼ë¬¸ìƒí’ˆë“¤ì˜ ê°€ê²©ì„ ì¡°íšŒí•´ì„œ ë”í•œ ê°’ì„ ë°˜í™˜í•œë‹¤.
  - ì‹¤ë¬´ì—ì„œëŠ” ì£¼ë¡œ ì£¼ë¬¸ì— ì „ì²´ ì£¼ë¬¸ ê°€ê²© í•„ë“œë¥¼ ë‘ê³  ì—­ì •ê·œí™” í•œë‹¤.

### [ì£¼ë¬¸ ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ](..%2F..%2Fsrc%2Fmain%2Fjava%2Fddangme%2Fjpa%2Fdomain%2FOrderItem.java)
```java
public static OrderItem createOrderItem(Item item, int orderPrice, int count) {
    OrderItem orderItem = new OrderItem();
    orderItem.setItem(item);
    orderItem.setOrderPrice(orderPrice);
    orderItem.setCount(count);
    
    item.removeStock(count);

    return orderItem;
}

public void cancel() {
    getItem().addStock(count);
}

public int getTotalPrice() {
    return getOrderPrice() * getCount();
}
```

#### ê¸°ëŠ¥ ì„¤ëª…
- `createOrderItem()`
  - ì£¼ë¬¸ ìƒí’ˆ, ê°€ê²©, ìˆ˜ëŸ‰ ì •ë³´ë¥¼ ì‚¬ìš©í•´ì„œ ì£¼ë¬¸ ìƒí’ˆ ì—”í‹°í‹°ë¥¼ ìƒì„±í•œë‹¤.
  - ê·¸ë¦¬ê³  `item.removeStock(count)`ë¥¼ í˜¸ì¶œí•´ì„œ ì£¼ë¬¸í•œ ìˆ˜ëŸ‰ë§Œí¼ ìƒí’ˆì˜ ì¬ê³ ë¥¼ ì¤„ì¸ë‹¤.
- `cancel()`
  - `getItem().addStock(count)`ë¥¼ í˜¸ì¶œí•´ì„œ ì·¨ì†Œí•œ ì£¼ë¬¸ ìˆ˜ëŸ‰ë§Œí¼ ìƒí’ˆì˜ ì¬ê³ ë¥¼ ì¦ê°€ì‹œí‚¨ë‹¤.
- `getTotalPrice()`
  - ì£¼ë¬¸ ê°€ê²©ì— ìˆ˜ëŸ‰ì„ ê³±í•œ ê°’ì„ ë°˜í™˜í•œë‹¤.

### [ì£¼ë¬¸ ë ˆí¬ì§€í† ë¦¬ ê°œë°œ](..%2F..%2Fsrc%2Fmain%2Fjava%2Fddangme%2Fjpa%2Frepository%2FOrderRepository.java)
```java
@Repository
@RequiredArgsConstructor
public class OrderRepository {

    private final EntityManager em;

    public void save(Order order) {
        em.persist(order);
    }

    public Order findOne(Long id) {
        return em.find(Order.class, id);
    }
}
```

### [ì£¼ë¬¸ ì„œë¹„ìŠ¤ ê°œë°œ](..%2F..%2Fsrc%2Fmain%2Fjava%2Fddangme%2Fjpa%2Fservice%2FOrderService.java)
```java
@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor
public class OrderService {

    private final MemberRepository memberRepository;
    private final OrderRepository orderRepository;
    private final ItemRepository itemRepository;

    @Transactional
    public Long order(Long memberId, Long itemId, int count) {
        Member member = memberRepository.findOne(memberId);
        Item item = itemRepository.findOne(itemId);

        Delivery delivery = new Delivery();
        delivery.setAddress(member.getAddress());
        delivery.setStatus(DeliveryStatus.READY);

        OrderItem orderItem = OrderItem.createOrderItem(item, item.getPrice(), count);

        Order order = Order.createOrder(member, delivery, orderItem);
        
        orderRepository.save(order);

        return order.getId();
    }

    @Transactional
    public void cancelOrder(Long orderId) {
        Order order = orderRepository.findOne(orderId);

        order.cancel();
    }
}
```

ì£¼ë¬¸ ì„œë¹„ìŠ¤ëŠ” ì£¼ë¬¸ ì—”í‹°í‹°ì™€ ì£¼ë¬¸ ìƒí’ˆ ì—”í‹°í‹°ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í™œìš©í•´ì„œ ì£¼ë¬¸, ì£¼ë¬¸ ì·¨ì†Œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

#### ê¸°ëŠ¥ ì„¤ëª…
ì°¸ê³ : ì˜ˆì œë¥¼ ë‹¨ìˆœí™”í•˜ê¸° ìœ„í•´, í•œ ë²ˆì— í•˜ë‚˜ì˜ ìƒí’ˆë§Œ ì£¼ë¬¸í•  ìˆ˜ ìˆë‹¤.
- `order()`
  - ì£¼ë¬¸í•˜ëŠ” íšŒì› ì‹ë³„ì, ìƒí’ˆ ì‹ë³„ì, ì£¼ë¬¸ ìˆ˜ëŸ‰ ì •ë³´ë¥¼ ë°›ì•„ì„œ ì‹¤ì œ ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ìƒì„±í•œ í›„ ì €ì¥í•œë‹¤.
- `cancelOrder()`
  - ì£¼ë¬¸ ì‹ë³„ìë¥¼ ë°›ì•„ì„œ ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•œ í›„ ì£¼ë¬¸ ì—”í‹°í‹°ì—ì„œ ì£¼ë¬¸ ì·¨ì†Œ ìš”ì²­ì„ í•œë‹¤.

> ğŸ€ ì£¼ë¬¸ ì„œë¹„ìŠ¤ì˜ ì£¼ë¬¸ê³¼ ì£¼ë¬¸ ì·¨ì†Œ ë©”ì„œë“œë¥¼ ë³´ë©´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ëŒ€ë¶€ë¶„ì´ ì—”í‹°í‹°ì— ìˆë‹¤.
> ì„œë¸Œì‹œ ê³„ì¸µì€ ë‹¨ìˆœíˆ ì—”í‹°í‹°ì— í•„ìš”í•œ ìš”ì²­ì„ ìœ„ì„í•˜ëŠ” ì—­í• ì„ í•œë‹¤.
> ì´ì²˜ëŸ¼ ì—”í‹°í‹°ê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ê°€ì§€ê³  ê°ì²´ ì§€í–¥ì˜ íŠ¹ì„±ì„ ì ê·¹ í™œìš©í•˜ëŠ” ê²ƒì„
> **ë„ë©”ì¸ ëª¨ë¸ íŒ¨í„´**ì´ë¼ê³  í•œë‹¤.
> ë°˜ëŒ€ë¡œ ì—”í‹°í‹°ì—ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ê±°ì˜ì—†ê³  ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ëŒ€ë¶€ë¶„ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” ê²ƒì„ **íŠ¸ëœì­ì…˜ ìŠ¤í¬ë¦½íŠ¸ íŒ¨í„´**ì´ë¼ê³  í•œë‹¤.

### [ì£¼ë¬¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸](..%2F..%2Fsrc%2Ftest%2Fjava%2Fddangme%2Fjpa%2Fservice%2FOrderServiceTest.java)
#### í…ŒìŠ¤íŠ¸ ìš”êµ¬ì‚¬í•­
- ìƒí’ˆ ì£¼ë¬¸ì´ ì„±ê³µí•´ì•¼ í•œë‹¤.
- ìƒí’ˆì„ ì£¼ë¬¸í•  ë•Œ ì¬ê³  ìˆ˜ëŸ‰ì„ ì´ˆê³¼í•˜ë©´ ì•ˆëœë‹¤.
- ì£¼ë¬¸ ì·¨ì†Œê°€ ì„±ê³µí•´ì•¼ í•œë‹¤.
```java
@SpringBootTest
@Transactional
class OrderServiceTest {

    @PersistenceContext
    EntityManager em;

    @Autowired
    OrderService orderService;

    @Autowired
    OrderRepository orderRepository;

    @Test
    void ìƒí’ˆì£¼ë¬¸() throws Exception {
        // Given
        Member member = createMember();
        Item item = createBook("ì‹œê³¨ JPA", 10_000, 10);
        int orderCount = 2;

        // When
        Long orderId = orderService.order(member.getId(), item.getId(), orderCount);

        // Then
        Order getOrder = orderRepository.findOne(orderId);

        assertThat(getOrder.getOrderStatus()).isEqualTo(OrderStatus.ORDER);
        assertThat(getOrder.getOrderItems().size()).isEqualTo(1);
        assertThat(getOrder.getTotalPrice()).isEqualTo(10_000 * 2);
        assertThat(item.getStockQuantity()).isEqualTo(8);
    }

    @Test
    void ìƒí’ˆì£¼ë¬¸_ì¬ê³ ìˆ˜ëŸ‰_ì´ˆê³¼() throws Exception {
        // Given
        Member member = createMember();
        Item item = createBook("ì‹œê³¨ JPA", 10_000, 10);

        int orderCount = 11;

        // When & Then
        assertThatThrownBy(() -> {
            orderService.order(member.getId(), item.getId(), orderCount);
        })
                .isInstanceOf(NotEnoughStockException.class)
                .hasMessage("need more stock");

    }

    @Test
    void ì£¼ë¬¸_ì·¨ì†Œ() {
        // Given
        Member member = createMember();
        Item item = createBook("ì‹œê³¨ JPA", 10_000, 10);

        int orderCount = 2;

        Long orderId = orderService.order(member.getId(), item.getId(), orderCount);

        // When
        orderService.cancelOrder(orderId);

        // Then
        Order getOrder = orderRepository.findOne(orderId);

        assertThat(getOrder.getOrderStatus()).isEqualTo(OrderStatus.CANCEL);
        assertThat(item.getStockQuantity()).isEqualTo(10);

    }

    private Member createMember() {
        Member member = new Member();
        member.setName("íšŒì›1");
        member.setAddress(new Address("ì„œìš¸", "ê°•ê°€", "123-123")); em.persist(member);
        return member;
    }

    private Book createBook(String name, int price, int stockQuantity) {
        Book book = new Book();
        book.setName(name);
        book.setStockQuantity(stockQuantity);
        book.setPrice(price);
        em.persist(book);
        return book;
    }
}
```